{"ast":null,"code":"import _regeneratorRuntime from\"C:/program/samurai-way-TS/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/program/samurai-way-TS/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _objectSpread from\"C:/program/samurai-way-TS/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{api}from'../api/api';import{errorFromStatusCodeOrApplication}from'../utils/error-utils';var initialStateApp={isLoading:false,authorizedStatus:'initialization',authorizedUser:{id:null,email:null,login:null},authorizedProfileUser:{photos:{small:null}},serverError:null};export var appReducer=function appReducer(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:initialStateApp;var action=arguments.length>1?arguments[1]:undefined;switch(action.type){case'APP/IS_LOADING':return _objectSpread(_objectSpread({},state),{},{isLoading:action.payload});case'APP/SET_AUTHORIZED_USER':return _objectSpread(_objectSpread({},state),{},{authorizedUser:_objectSpread({},action.user)});case'APP/SET_AUTHORIZED_PROFILE_USER':return _objectSpread(_objectSpread({},state),{},{authorizedProfileUser:action.payload});case'APP/SET_AUTHORIZED_STATUS':return _objectSpread(_objectSpread({},state),{},{authorizedStatus:action.payload});case'APP/SET-SERVER-ERROR':return _objectSpread(_objectSpread({},state),{},{serverError:action.payload});case'PROFILE/UPDATE_AVATAR_SUCCESS':{var photos=_objectSpread({},action.payload);return _objectSpread(_objectSpread({},state),{},{authorizedProfileUser:_objectSpread(_objectSpread({},state.authorizedProfileUser),{},{photos:photos})});}default:return state;}};//action\nexport var setIsLoading=function setIsLoading(payload){return{type:'APP/IS_LOADING',payload:payload};};export var setAuthorizedUser=function setAuthorizedUser(user){return{type:'APP/SET_AUTHORIZED_USER',user:user};};export var setAuthorizedStatus=function setAuthorizedStatus(payload){return{type:'APP/SET_AUTHORIZED_STATUS',payload:payload};};export var setAuthorizedProfileUser=function setAuthorizedProfileUser(payload){return{type:'APP/SET_AUTHORIZED_PROFILE_USER',payload:payload};};export var setServerError=function setServerError(payload){return{type:'APP/SET-SERVER-ERROR',payload:payload};};//thunk\nexport var fetchAuthorizedData=function fetchAuthorizedData(){return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(dispatch){var response,responseUser,error;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;dispatch(setIsLoading(true));_context.next=4;return api.authorizedMe();case 4:response=_context.sent;if(!(response.resultCode===0)){_context.next=15;break;}dispatch(setAuthorizedUser(response.data));dispatch(setAuthorizedStatus('successfully'));if(!response.data.id){_context.next=13;break;}_context.next=11;return api.getUserProfile(response.data.id);case 11:responseUser=_context.sent;dispatch(setAuthorizedProfileUser(responseUser));case 13:_context.next=16;break;case 15:dispatch(setAuthorizedStatus('fail'));case 16:_context.next=22;break;case 18:_context.prev=18;_context.t0=_context[\"catch\"](0);error=_context.t0;errorFromStatusCodeOrApplication(error,dispatch);case 22:_context.prev=22;dispatch(setIsLoading(false));return _context.finish(22);case 25:case\"end\":return _context.stop();}}},_callee,null,[[0,18,22,25]]);}));return function(_x){return _ref.apply(this,arguments);};}();};export var fetchAuthorization=function fetchAuthorization(email,password,setStatus){return/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(dispatch){var response,error;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;dispatch(setIsLoading(true));_context2.next=4;return api.authorize(email,password);case 4:response=_context2.sent;if(response.resultCode===0){dispatch(fetchAuthorizedData());}else if(response.resultCode!==0){setStatus(response.messages[0]);}_context2.next=12;break;case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](0);error=_context2.t0;errorFromStatusCodeOrApplication(error,dispatch);case 12:_context2.prev=12;dispatch(setIsLoading(false));return _context2.finish(12);case 15:case\"end\":return _context2.stop();}}},_callee2,null,[[0,8,12,15]]);}));return function(_x2){return _ref2.apply(this,arguments);};}();};export var fetchLogout=function fetchLogout(){return/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(dispatch){var response,error;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;dispatch(setIsLoading(true));_context3.next=4;return api.logout();case 4:response=_context3.sent;if(response.resultCode===0){dispatch(fetchAuthorizedData());}_context3.next=12;break;case 8:_context3.prev=8;_context3.t0=_context3[\"catch\"](0);error=_context3.t0;errorFromStatusCodeOrApplication(error,dispatch);case 12:_context3.prev=12;dispatch(setIsLoading(false));return _context3.finish(12);case 15:case\"end\":return _context3.stop();}}},_callee3,null,[[0,8,12,15]]);}));return function(_x3){return _ref3.apply(this,arguments);};}();};//type","map":{"version":3,"names":["api","errorFromStatusCodeOrApplication","initialStateApp","isLoading","authorizedStatus","authorizedUser","id","email","login","authorizedProfileUser","photos","small","serverError","appReducer","state","action","type","payload","user","setIsLoading","setAuthorizedUser","setAuthorizedStatus","setAuthorizedProfileUser","setServerError","fetchAuthorizedData","dispatch","authorizedMe","response","resultCode","data","getUserProfile","responseUser","error","fetchAuthorization","password","setStatus","authorize","messages","fetchLogout","logout"],"sources":["C:/program/samurai-way-TS/src/redux/appReducer.ts"],"sourcesContent":["import {api, AuthorizedUserType, UserProfileType} from '../api/api';\r\nimport {AppThunk} from './store';\r\nimport axios, {AxiosError} from 'axios';\r\nimport {errorFromStatusCodeOrApplication} from '../utils/error-utils';\r\nimport {updateAvatarSuccess} from './profileReducer';\r\n\r\nlet initialStateApp = {\r\n    isLoading: false,\r\n    authorizedStatus: 'initialization' as StatusAuthorizedType,\r\n    authorizedUser: {\r\n        id: null,\r\n        email: null,\r\n        login: null\r\n    } as AuthorizedUserType,\r\n    authorizedProfileUser: {\r\n        photos: {small: null}\r\n    } as UserProfileType,\r\n    serverError: null as null | string\r\n}\r\n\r\nexport const appReducer = (state = initialStateApp, action: ActionAppReducerType): InitialStateTypeApp => {\r\n    switch (action.type) {\r\n        case 'APP/IS_LOADING':\r\n            return {\r\n                ...state,\r\n                isLoading: action.payload\r\n            }\r\n        case 'APP/SET_AUTHORIZED_USER':\r\n            return {\r\n                ...state,\r\n                authorizedUser: {...action.user},\r\n            }\r\n        case 'APP/SET_AUTHORIZED_PROFILE_USER':\r\n            return {\r\n                ...state,\r\n                authorizedProfileUser: action.payload\r\n            }\r\n        case 'APP/SET_AUTHORIZED_STATUS':\r\n            return {\r\n                ...state,\r\n                authorizedStatus: action.payload\r\n            }\r\n        case 'APP/SET-SERVER-ERROR':\r\n            return {...state, serverError: action.payload}\r\n        case 'PROFILE/UPDATE_AVATAR_SUCCESS': {\r\n            const photos = {...action.payload}\r\n            return {\r\n                ...state,\r\n                authorizedProfileUser: {\r\n                    ...state.authorizedProfileUser,\r\n                    photos: photos\r\n                }\r\n            }\r\n        }\r\n        default:\r\n            return state\r\n    }\r\n}\r\n\r\n//action\r\nexport const setIsLoading = (payload: boolean) => ({type: 'APP/IS_LOADING', payload} as const)\r\nexport const setAuthorizedUser = (user: AuthorizedUserType) => ({type: 'APP/SET_AUTHORIZED_USER', user} as const)\r\nexport const setAuthorizedStatus = (payload: StatusAuthorizedType) =>\r\n    ({type: 'APP/SET_AUTHORIZED_STATUS', payload} as const)\r\nexport const setAuthorizedProfileUser = (payload: UserProfileType) =>\r\n    ({type: 'APP/SET_AUTHORIZED_PROFILE_USER', payload} as const)\r\nexport const setServerError = (payload: string | null) => ({type: 'APP/SET-SERVER-ERROR', payload} as const)\r\n\r\n//thunk\r\nexport const fetchAuthorizedData = (): AppThunk => async dispatch => {\r\n    try {\r\n        dispatch(setIsLoading(true))\r\n\r\n        let response = await api.authorizedMe()\r\n        if (response.resultCode === 0) {\r\n            dispatch(setAuthorizedUser(response.data))\r\n            dispatch(setAuthorizedStatus('successfully'))\r\n            if (response.data.id) {\r\n                let responseUser = await api.getUserProfile(response.data.id)\r\n                dispatch(setAuthorizedProfileUser(responseUser))\r\n            }\r\n        } else {\r\n            dispatch(setAuthorizedStatus('fail'))\r\n        }\r\n    } catch (e) {\r\n        const error = e as Error | AxiosError\r\n        errorFromStatusCodeOrApplication(error, dispatch)\r\n    } finally {\r\n        dispatch(setIsLoading(false))\r\n    }\r\n}\r\nexport const fetchAuthorization = (email: string, password: string, setStatus: any): AppThunk => async dispatch => {\r\n    try {\r\n        dispatch(setIsLoading(true))\r\n        let response = await api.authorize(email, password)\r\n        if (response.resultCode === 0) {\r\n            dispatch(fetchAuthorizedData())\r\n        } else if (response.resultCode !== 0) {\r\n            setStatus(response.messages[0])\r\n        }\r\n    } catch (e) {\r\n        const error = e as Error | AxiosError\r\n        errorFromStatusCodeOrApplication(error, dispatch)\r\n    } finally {\r\n        dispatch(setIsLoading(false))\r\n    }\r\n}\r\nexport const fetchLogout = (): AppThunk => async dispatch => {\r\n    try {\r\n        dispatch(setIsLoading(true))\r\n        let response = await api.logout()\r\n        if (response.resultCode === 0) {\r\n            dispatch(fetchAuthorizedData())\r\n        }\r\n    } catch (e) {\r\n        const error = e as Error | AxiosError\r\n        errorFromStatusCodeOrApplication(error, dispatch)\r\n    } finally {\r\n        dispatch(setIsLoading(false))\r\n    }\r\n}\r\n\r\n//type\r\nexport type InitialStateTypeApp = typeof initialStateApp\r\nexport type StatusAuthorizedType = 'successfully' | 'initialization' | 'fail'\r\nexport type ActionAppReducerType =\r\n    ReturnType<typeof setIsLoading>\r\n    | ReturnType<typeof setAuthorizedUser>\r\n    | ReturnType<typeof setAuthorizedStatus>\r\n    | ReturnType<typeof setAuthorizedProfileUser>\r\n    | ReturnType<typeof setServerError>\r\n    | ReturnType<typeof updateAvatarSuccess>\r\n\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}