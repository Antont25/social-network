{"ast":null,"code":"import _regeneratorRuntime from\"C:/program/samurai-way-TS/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/program/samurai-way-TS/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _toConsumableArray from\"C:/program/samurai-way-TS/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _objectSpread from\"C:/program/samurai-way-TS/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{api}from'../api/api';import{setIsLoading}from'./appReducer';import{errorFromStatusCodeOrApplication}from'../utils/error-utils';var initialStateUserPage={items:[],totalCount:0,pageSize:10,currentPage:1,portionsNumber:1,error:null,userSubscription:[]};export var usersReducer=function usersReducer(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:initialStateUserPage;var action=arguments.length>1?arguments[1]:undefined;switch(action.type){case'USERS/SET_USERS':return _objectSpread(_objectSpread({},state),{},{items:action.payload.items,totalCount:action.payload.totalCount,error:action.payload.error});case'USERS/FOLLOW':return _objectSpread(_objectSpread({},state),{},{items:state.items.map(function(item){return item.id===action.payload?_objectSpread(_objectSpread({},item),{},{followed:true}):item;})});case'USERS/UN_FOLLOW':return _objectSpread(_objectSpread({},state),{},{items:state.items.map(function(item){return item.id===action.payload?_objectSpread(_objectSpread({},item),{},{followed:false}):item;})});case'USERS/SET_CURRENT_PAGE':return _objectSpread(_objectSpread({},state),{},{currentPage:action.payload});case'USERS/SET_PORTION_NUMBER':return _objectSpread(_objectSpread({},state),{},{portionsNumber:action.payload});case'USERS/ADD_USER_SUBSCRIPTION':return _objectSpread(_objectSpread({},state),{},{userSubscription:action.isFollowing?[].concat(_toConsumableArray(state.userSubscription),[action.userId]):state.userSubscription.filter(function(item){return item!==action.userId;})});default:return state;}};//action\nexport var setUsers=function setUsers(payload){return{type:'USERS/SET_USERS',payload:payload};};export var follow=function follow(payload){return{type:'USERS/FOLLOW',payload:payload};};export var unFollow=function unFollow(payload){return{type:'USERS/UN_FOLLOW',payload:payload};};export var setCurrentPage=function setCurrentPage(payload){return{type:'USERS/SET_CURRENT_PAGE',payload:payload};};export var setPortionsNumber=function setPortionsNumber(payload){return{type:'USERS/SET_PORTION_NUMBER',payload:payload};};export var setUserSubscription=function setUserSubscription(userId,isFollowing){return{type:'USERS/ADD_USER_SUBSCRIPTION',userId:userId,isFollowing:isFollowing};};//thunk\nexport var fetchUserData=function fetchUserData(currentPage){return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(dispatch){var response,error;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;dispatch(setIsLoading(true));_context.next=4;return api.getUser(currentPage);case 4:response=_context.sent;dispatch(setUsers(response));_context.next=12;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](0);error=_context.t0;errorFromStatusCodeOrApplication(error,dispatch);case 12:_context.prev=12;dispatch(setIsLoading(false));return _context.finish(12);case 15:case\"end\":return _context.stop();}}},_callee,null,[[0,8,12,15]]);}));return function(_x){return _ref.apply(this,arguments);};}();};export var fetchFollowUser=function fetchFollowUser(usersId){return/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(dispatch){var response,error;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;dispatch(setUserSubscription(usersId,true));_context2.next=4;return api.followUser(usersId);case 4:response=_context2.sent;if(response.resultCode===0){dispatch(follow(usersId));}_context2.next=12;break;case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](0);error=_context2.t0;errorFromStatusCodeOrApplication(error,dispatch);case 12:_context2.prev=12;dispatch(setUserSubscription(usersId,false));return _context2.finish(12);case 15:case\"end\":return _context2.stop();}}},_callee2,null,[[0,8,12,15]]);}));return function(_x2){return _ref2.apply(this,arguments);};}();};export var fetchUnFollowUser=function fetchUnFollowUser(usersId){return/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(dispatch){var response,error;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;dispatch(setUserSubscription(usersId,true));_context3.next=4;return api.unFollowUser(usersId);case 4:response=_context3.sent;if(response.resultCode===0){dispatch(unFollow(usersId));}_context3.next=12;break;case 8:_context3.prev=8;_context3.t0=_context3[\"catch\"](0);error=_context3.t0;errorFromStatusCodeOrApplication(error,dispatch);case 12:_context3.prev=12;dispatch(setUserSubscription(usersId,false));return _context3.finish(12);case 15:case\"end\":return _context3.stop();}}},_callee3,null,[[0,8,12,15]]);}));return function(_x3){return _ref3.apply(this,arguments);};}();};//type","map":{"version":3,"names":["api","setIsLoading","errorFromStatusCodeOrApplication","initialStateUserPage","items","totalCount","pageSize","currentPage","portionsNumber","error","userSubscription","usersReducer","state","action","type","payload","map","item","id","followed","isFollowing","userId","filter","setUsers","follow","unFollow","setCurrentPage","setPortionsNumber","setUserSubscription","fetchUserData","dispatch","getUser","response","fetchFollowUser","usersId","followUser","resultCode","fetchUnFollowUser","unFollowUser"],"sources":["C:/program/samurai-way-TS/src/redux/usersReducer.ts"],"sourcesContent":["import {api, FetchUserType, UserType} from '../api/api';\r\nimport {setIsLoading} from './appReducer';\r\nimport {AppThunk} from './store';\r\nimport {AxiosError} from 'axios';\r\nimport {errorFromStatusCodeOrApplication} from '../utils/error-utils';\r\n\r\nconst initialStateUserPage = {\r\n    items: [] as Array<UserType>,\r\n    totalCount: 0,\r\n    pageSize: 10,\r\n    currentPage: 1,\r\n    portionsNumber: 1,\r\n    error: null,\r\n    userSubscription: [] as Array<number>\r\n}\r\n\r\nexport const usersReducer = (state = initialStateUserPage, action: ActionUserReducerType): InitialStateUserPageType => {\r\n    switch (action.type) {\r\n        case 'USERS/SET_USERS':\r\n            return {\r\n                ...state,\r\n                items: action.payload.items,\r\n                totalCount: action.payload.totalCount,\r\n                error: action.payload.error\r\n            }\r\n        case 'USERS/FOLLOW':\r\n            return {\r\n                ...state,\r\n                items: state.items.map(item => item.id === action.payload\r\n                    ? {...item, followed: true}\r\n                    : item)\r\n            }\r\n        case 'USERS/UN_FOLLOW':\r\n            return {\r\n                ...state,\r\n                items: state.items.map(item => item.id === action.payload\r\n                    ? {...item, followed: false}\r\n                    : item)\r\n            }\r\n        case 'USERS/SET_CURRENT_PAGE':\r\n            return {\r\n                ...state,\r\n                currentPage: action.payload\r\n            }\r\n        case 'USERS/SET_PORTION_NUMBER':\r\n            return {\r\n                ...state,\r\n                portionsNumber: action.payload\r\n            }\r\n        case 'USERS/ADD_USER_SUBSCRIPTION':\r\n            return {\r\n                ...state,\r\n                userSubscription: action.isFollowing\r\n                    ? [...state.userSubscription, action.userId]\r\n                    : state.userSubscription.filter(item => item !== action.userId)\r\n            }\r\n        default:\r\n            return state\r\n    }\r\n}\r\n\r\n//action\r\nexport const setUsers = (payload: FetchUserType) => ({type: 'USERS/SET_USERS', payload} as const)\r\nexport const follow = (payload: number) => ({type: 'USERS/FOLLOW', payload} as const)\r\nexport const unFollow = (payload: number) => ({type: 'USERS/UN_FOLLOW', payload} as const)\r\nexport const setCurrentPage = (payload: number) => ({type: 'USERS/SET_CURRENT_PAGE', payload} as const)\r\nexport const setPortionsNumber = (payload: number) => ({type: 'USERS/SET_PORTION_NUMBER', payload} as const)\r\nexport const setUserSubscription = (userId: number, isFollowing: boolean) =>\r\n    ({type: 'USERS/ADD_USER_SUBSCRIPTION', userId, isFollowing} as const)\r\n\r\n//thunk\r\nexport const fetchUserData = (currentPage: number): AppThunk => async dispatch => {\r\n    try {\r\n        dispatch(setIsLoading(true))\r\n        let response = await api.getUser(currentPage)\r\n        dispatch(setUsers(response))\r\n    } catch (e) {\r\n        const error = e as Error | AxiosError\r\n        errorFromStatusCodeOrApplication(error, dispatch)\r\n    } finally {\r\n        dispatch(setIsLoading(false))\r\n    }\r\n\r\n}\r\nexport const fetchFollowUser = (usersId: number): AppThunk => async dispatch => {\r\n    try {\r\n        dispatch(setUserSubscription(usersId, true))\r\n        let response = await api.followUser(usersId)\r\n        if (response.resultCode === 0) {\r\n            dispatch(follow(usersId))\r\n        }\r\n    } catch (e) {\r\n        const error = e as Error | AxiosError\r\n        errorFromStatusCodeOrApplication(error, dispatch)\r\n    } finally {\r\n        dispatch(setUserSubscription(usersId, false))\r\n    }\r\n}\r\nexport const fetchUnFollowUser = (usersId: number): AppThunk => async dispatch => {\r\n    try {\r\n        dispatch(setUserSubscription(usersId, true))\r\n        let response = await api.unFollowUser(usersId)\r\n        if (response.resultCode === 0) {\r\n            dispatch(unFollow(usersId))\r\n        }\r\n    } catch (e) {\r\n        const error = e as Error | AxiosError\r\n        errorFromStatusCodeOrApplication(error, dispatch)\r\n    } finally {\r\n        dispatch(setUserSubscription(usersId, false))\r\n    }\r\n}\r\n\r\n//type\r\nexport type InitialStateUserPageType = {\r\n    items: Array<UserType>\r\n    totalCount: number\r\n    pageSize: number\r\n    currentPage: number\r\n    error: null\r\n    portionsNumber: number\r\n    userSubscription: Array<number>\r\n}\r\nexport type ActionUserReducerType = ReturnType<typeof setUsers>\r\n    | ReturnType<typeof follow>\r\n    | ReturnType<typeof unFollow>\r\n    | ReturnType<typeof setCurrentPage>\r\n    | ReturnType<typeof setPortionsNumber>\r\n    | ReturnType<typeof setUserSubscription>\r\n\r\n\r\n\r\n\r\n\r\n\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}